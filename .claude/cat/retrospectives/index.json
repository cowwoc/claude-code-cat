{
  "version": "2.0",
  "config": {
    "mistake_count_threshold": 10,
    "trigger_interval_days": 7
  },
  "last_retrospective": "2026-01-28T10:47:26-05:00",
  "mistake_count_since_last": 0,
  "files": {
    "mistakes": [
      "mistakes-2026-01.json"
    ],
    "retrospectives": [
      "retrospectives-2026-01.json"
    ]
  },
  "patterns": [
    {
      "pattern_id": "PATTERN-001",
      "pattern": "subagent_validation_fabrication",
      "occurrences_total": 6,
      "occurrences_after_fix": 2,
      "first_seen": "2026-01-26T17:00:00Z",
      "last_seen": "2026-01-27T10:00:00Z",
      "last_action_date": null,
      "status": "recurring",
      "effectiveness": "pending",
      "preventions": [
        "M269",
        "M270",
        "M271",
        "M273",
        "M274",
        "M276"
      ],
      "related_action_items": [
        "A001"
      ],
      "note": "Subagents fabricate or skip validation scores when delegation prompts prime expected values or combine producer/validator roles"
    },
    {
      "pattern_id": "PATTERN-002",
      "pattern": "task_status_lifecycle_violation",
      "occurrences_total": 2,
      "occurrences_after_fix": 2,
      "first_seen": "2026-01-27T11:00:00Z",
      "last_seen": "2026-01-27T12:00:00Z",
      "last_action_date": null,
      "status": "recurring",
      "effectiveness": "pending",
      "preventions": [
        "M278",
        "M279"
      ],
      "related_action_items": [
        "A002"
      ],
      "note": "Incorrect task state transitions: abort marked as completed, decomposed parents marked completed before subtasks done"
    },
    {
      "pattern_id": "PATTERN-003",
      "pattern": "path_config_assumption",
      "occurrences_total": 3,
      "occurrences_after_fix": 4,
      "first_seen": "2026-01-26T18:00:00Z",
      "last_seen": "2026-01-27T09:00:00Z",
      "last_action_date": null,
      "status": "recurring",
      "effectiveness": "pending",
      "preventions": [
        "M266",
        "M267",
        "M268"
      ],
      "related_action_items": [
        "A003"
      ],
      "note": "Assumptions about paths or config values without verification - worktree paths, terminal width, abort semantics"
    },
    {
      "pattern_id": "PATTERN-004",
      "pattern": "user_message_ignored_mid_operation",
      "occurrences_total": 2,
      "occurrences_after_fix": 0,
      "first_seen": "2026-01-25T14:10:00Z",
      "last_seen": "2026-01-28T10:30:00Z",
      "last_action_date": null,
      "status": "new",
      "effectiveness": "pending",
      "preventions": [
        "M247",
        "M289"
      ],
      "related_action_items": [
        "A004"
      ],
      "note": "User questions arriving mid-operation via system-reminders are ignored instead of being acknowledged immediately"
    }
  ],
  "action_items": [
    {
      "id": "A001",
      "priority": "high",
      "description": "Enforce validation separation: subagents that PRODUCE output must NOT validate it. Add explicit check in subagent-delegation.md and fail-fast in work.md when subagent claims validation without tool evidence",
      "category": "protocol_violation",
      "pattern_id": "PATTERN-001",
      "status": "implemented",
      "created_date": "2026-01-27T12:30:00Z",
      "completed_date": "2026-01-27T12:30:00Z",
      "related_mistakes": [
        "M269",
        "M270",
        "M271",
        "M273",
        "M274",
        "M276"
      ],
      "effectiveness_check": {
        "mistakes_before": 6,
        "mistakes_after": 2,
        "post_fix_mistakes": [
          "M269",
          "M273"
        ],
        "verdict": "partially_effective"
      }
    },
    {
      "id": "A002",
      "priority": "high",
      "description": "Add hook-level validation for task status transitions: abort restores to pending, decomposed parents stay pending until all subtasks complete",
      "category": "protocol_violation",
      "pattern_id": "PATTERN-002",
      "status": "implemented",
      "created_date": "2026-01-27T12:30:00Z",
      "completed_date": "2026-01-27T12:30:00Z",
      "related_mistakes": [
        "M278",
        "M279"
      ],
      "effectiveness_check": {
        "mistakes_before": 2,
        "mistakes_after": 2,
        "post_fix_mistakes": [
          "M278",
          "M280"
        ],
        "verdict": "partially_effective"
      }
    },
    {
      "id": "A003",
      "priority": "medium",
      "description": "Document path and config verification requirements: always check worktree context, read cat-config.json before using values, clarify abort semantics",
      "category": "assumption_without_verification",
      "pattern_id": "PATTERN-003",
      "status": "escalated",
      "created_date": "2026-01-27T12:30:00Z",
      "completed_date": "2026-01-27T17:45:00Z",
      "related_mistakes": [
        "M266",
        "M267",
        "M268"
      ],
      "implementation": "Added 'Path and Config Verification (A003)' section to agent-architecture.md with worktree path handling, config resolution strategy, and terminology disambiguation guidelines",
      "effectiveness_check": {
        "mistakes_before": 3,
        "mistakes_after": 4,
        "post_fix_mistakes": [
          "M267",
          "M268",
          "M281",
          "M286"
        ],
        "verdict": "ineffective"
      },
      "escalation": {
        "id": "ESCALATE-A003",
        "escalated_date": "2026-01-28T11:30:00-05:00",
        "reason": "Documentation-level prevention ineffective (4 post-fix mistakes vs 3 before)",
        "escalation_level": "hook",
        "implementation": "Enhanced warn-base-branch-edit.sh to detect and warn when Edit/Write uses absolute /workspace/ paths while in a worktree, bypassing isolation",
        "prevention_path": "${CLAUDE_PLUGIN_ROOT}/hooks/warn-base-branch-edit.sh"
      }
    },
    {
      "id": "A004",
      "priority": "high",
      "description": "Strengthen user input handling: clarify that current task means current tool call not entire workflow. Add explicit instruction to respond in very next message when system-reminder contains user question.",
      "category": "protocol_violation",
      "pattern_id": "PATTERN-004",
      "status": "implemented",
      "created_date": "2026-01-27T21:55:08-05:00",
      "completed_date": "2026-01-27T21:55:08-05:00",
      "related_mistakes": [
        "M247",
        "M289"
      ],
      "implementation": "Updated inject-session-instructions.sh to clarify that IMPORTANT After completing your current task means after current tool call, not entire workflow",
      "effectiveness_check": {
        "mistakes_before": 2,
        "mistakes_after": null,
        "post_fix_mistakes": [],
        "verdict": "pending"
      }
    },
    {
      "id": "A005",
      "priority": "high",
      "description": "Enforce main agent delegation boundary: main agent NEVER uses Write/Edit tools on source files during task execution. All implementation work must be delegated to subagents.",
      "category": "protocol_violation",
      "pattern_id": "PATTERN-005",
      "status": "implemented",
      "created_date": "2026-01-28T11:00:00Z",
      "completed_date": "2026-01-28T11:30:00-05:00",
      "related_mistakes": [
        "M294",
        "M296",
        "M297",
        "M302"
      ],
      "implementation": "Hook warn-base-branch-edit.sh already warns about main agent source edits (A003/M097/M302). Emits warning when Edit/Write targets non-orchestration files. Warning includes delegation guidance.",
      "prevention_path": "${CLAUDE_PLUGIN_ROOT}/hooks/warn-base-branch-edit.sh",
      "effectiveness_check": {
        "mistakes_before": 4,
        "mistakes_after": null,
        "post_fix_mistakes": [],
        "verdict": "pending"
      }
    },
    {
      "id": "A006",
      "priority": "medium",
      "description": "Prevent test data fabrication: when testing commands/scripts, always use real values from context (e.g., session ID from SessionStart) instead of placeholder/fabricated data.",
      "category": "assumption_without_verification",
      "pattern_id": "PATTERN-006",
      "status": "implemented",
      "created_date": "2026-01-28T11:00:00Z",
      "completed_date": "2026-01-28T11:30:00-05:00",
      "related_mistakes": [
        "M300",
        "M303"
      ],
      "implementation": "Added anti-pattern M300 to work.md documenting that session IDs must come from SessionStart context, not fabricated placeholders. Script validates UUID format and fails on invalid input.",
      "prevention_path": "${CLAUDE_PLUGIN_ROOT}/concepts/work.md",
      "effectiveness_check": {
        "mistakes_before": 2,
        "mistakes_after": null,
        "post_fix_mistakes": [],
        "verdict": "pending"
      }
    }
  ]
}
